<!doctype html><html lang="en"><meta charset="UTF-8"><meta content="width=device-width,initial-scale=1" name="viewport"><title>AGENT JOE</title><style>@import url(https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap);*{margin:0;padding:0;box-sizing:border-box}body{background:linear-gradient(135deg,beige 0,#e8e8d0 100%);color:#2a2a2a;font-family:'Courier New',monospace;min-height:100vh;overflow-x:hidden;display:flex;justify-content:center;align-items:center}.scanlines{position:fixed;top:0;left:0;width:100%;height:100%;background:repeating-linear-gradient(0deg,rgba(0,0,0,.03),rgba(0,0,0,.03) 1px,transparent 1px,transparent 2px);pointer-events:none;z-index:1000}.container{width:100%;max-width:950px;padding:20px;position:relative}.header{text-align:center;padding:20px 0;margin-bottom:20px}h1{font-family:'Press Start 2P',cursive;font-size:2.5em;color:#ff6b35;text-shadow:3px 3px 0 #4a90e2;margin-bottom:10px;animation:2s infinite pulse}@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}.subtitle{color:#4a90e2;font-size:.9em;font-family:'Press Start 2P',cursive}.game-layout{display:flex;gap:25px;align-items:flex-start;justify-content:center}.maze-container{display:flex;flex-direction:column;gap:20px;width:600px}.maze-wrapper{background:#fff;border:4px solid #2a2a2a;border-radius:8px;padding:20px;box-shadow:8px 8px 0 #4a90e2,16px 16px 0 #ff6b35;position:relative;display:flex;justify-content:center;align-items:center;width:600px;box-sizing:border-box}#maze-canvas{width:540px;height:540px;image-rendering:pixelated;image-rendering:crisp-edges;background:#fafafa;border:2px solid #ddd;display:block}.bottom-panels{display:flex;gap:12px;width:600px;justify-content:center}.control-panel{flex:1;display:flex;flex-direction:column;gap:15px;min-width:400px;max-width:450px}.panel{background:#fff;border:3px solid #2a2a2a;border-radius:8px;padding:20px;box-shadow:6px 6px 0 #4a90e2;position:relative}.panel.compact{padding:16px;flex:0 0 290px;width:290px;box-sizing:border-box}.panel.compact .panel-title{font-size:.75em;margin-bottom:10px;text-align:center}.panel.compact .status-grid{gap:6px;grid-template-columns:repeat(2,1fr);display:grid;width:100%}.panel.compact .status-item{padding:6px 4px;height:45px;min-width:80px;display:flex;flex-direction:column;justify-content:center;align-items:center;box-sizing:border-box}.panel.compact .vision-display{grid-template-columns:repeat(3,35px);grid-template-rows:repeat(3,35px);gap:3px;margin:0 auto}.panel.compact .vision-cell{font-size:.5em}.panel-title{font-family:'Press Start 2P',cursive;font-size:.9em;color:#ff6b35;margin-bottom:15px;display:flex;align-items:center;gap:10px}.status-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:15px}.status-item{background:#f0f0f0;padding:10px;border:2px solid #ddd;border-radius:4px;text-align:center}.status-label{font-size:.7em;color:#666;text-transform:uppercase;margin-bottom:5px;font-weight:700}.status-value{font-family:'Press Start 2P',cursive;font-size:.8em;color:#4a90e2;min-width:80px;display:inline-block}.panel.compact .status-value{font-size:.7em;min-width:80px;width:100%;text-align:center;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.panel.compact .status-label{text-align:center;width:100%}.vision-display{display:grid;grid-template-columns:repeat(3,50px);grid-template-rows:repeat(3,50px);gap:5px;justify-content:center;margin:20px 0}.vision-cell{border:2px solid #ddd;background:#f9f9f9;display:flex;align-items:center;justify-content:center;font-family:'Press Start 2P',cursive;font-size:.6em;color:#666;position:relative}.vision-cell.wall{background:#2a2a2a;color:#fff}.vision-cell.empty{background:#e8f5e9}.vision-cell.joe{background:#ffeb3b;color:#2a2a2a;font-weight:700}.vision-cell.exit{background:linear-gradient(45deg,#4caf50,#8bc34a);color:#fff}#prompt-input{width:100%;min-height:315px;background:#f9f9f9;border:2px solid #ddd;color:#2a2a2a;padding:15px;font-family:'Courier New',monospace;font-size:14px;resize:vertical;border-radius:4px}#prompt-input:focus{outline:0;border-color:#4a90e2;box-shadow:0 0 10px rgba(74,144,226,.3)}.button-container{display:flex;gap:10px;margin-top:15px;flex-wrap:wrap;justify-content:center}button{font-family:'Press Start 2P',cursive;font-size:.8em;padding:12px 20px;background:#4a90e2;color:#fff;border:3px solid #2a2a2a;cursor:pointer;border-radius:4px;transition:.2s;box-shadow:3px 3px 0 #2a2a2a;flex:1}button:hover{transform:translate(-2px,-2px);box-shadow:5px 5px 0 #2a2a2a}button:active{transform:translate(0,0);box-shadow:1px 1px 0 #2a2a2a}button:disabled{background:#bbb;cursor:not-allowed;opacity:.6}button.danger{background:#ff6b35}button.success{background:#4caf50}button.warning{background:orange}.move-history{background:#f0f0f0;border:2px solid #ddd;border-radius:4px;padding:10px;height:174px;overflow-y:auto;font-size:.85em;font-family:'Courier New',monospace}.move-item{padding:3px 0;color:#666}.move-item.error{color:#ff6b35}.loading-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,.95);z-index:2000;justify-content:center;align-items:center;flex-direction:column}.loading-overlay.active{display:flex}.loading-text{font-family:'Press Start 2P',cursive;color:#4a90e2;font-size:1.2em;margin-bottom:20px;animation:1s infinite blink}@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}.spinner{width:50px;height:50px;border:4px solid #ddd;border-top:4px solid #4a90e2;border-radius:50%;animation:1s linear infinite spin}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.message-box{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border:4px solid #2a2a2a;padding:30px;z-index:3000;text-align:center;display:none;max-width:500px;border-radius:8px;box-shadow:8px 8px 0 #4a90e2,16px 16px 0 #ff6b35}.message-box.active{display:block;animation:.3s ease-out popIn}@keyframes popIn{from{transform:translate(-50%,-50%) scale(.8);opacity:0}to{transform:translate(-50%,-50%) scale(1);opacity:1}}.message-title{font-family:'Press Start 2P',cursive;font-size:1.2em;color:#ff6b35;margin-bottom:20px}.message-content{color:#2a2a2a;line-height:1.6;margin-bottom:20px}.legend{display:flex;gap:20px;justify-content:center;margin-top:15px;flex-wrap:wrap}.legend-item{display:flex;align-items:center;gap:8px;font-size:.85em}.legend-color{width:20px;height:20px;border:2px solid #2a2a2a;border-radius:2px}@media (max-width:1200px){.game-layout{flex-direction:column}.control-panel{width:100%}}.settings-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:4000;justify-content:center;align-items:center}.settings-modal.active{display:flex;animation:.2s ease-out fadeIn}@keyframes fadeIn{from{opacity:0}to{opacity:1}}.modal-content{background:beige;border:4px solid #2a2a2a;border-radius:8px;width:90%;max-width:900px;max-height:90vh;overflow-y:auto;box-shadow:8px 8px 0 #4a90e2,16px 16px 0 #ff6b35;animation:.3s ease-out slideIn}@keyframes slideIn{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header{background:#fff;border-bottom:3px solid #2a2a2a;padding:15px 20px;display:flex;justify-content:space-between;align-items:center}.modal-header h2{font-family:'Press Start 2P',cursive;font-size:1.2em;color:#ff6b35;margin:0}.close-btn{background:0 0;border:none;font-size:2em;color:#2a2a2a;cursor:pointer;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:4px;transition:.2s}.close-btn:hover{background:#ff6b35;color:#fff}.modal-body{padding:20px;background:#fff}.settings-row{display:flex;gap:30px}.settings-column{flex:1}.setting-group{margin-bottom:20px;padding:15px;background:#f9f9f9;border:2px solid #ddd;border-radius:4px}.setting-group label{display:block;font-family:'Press Start 2P',cursive;font-size:.7em;color:#4a90e2;margin-bottom:10px}.setting-group select{width:100%;padding:8px;font-family:'Courier New',monospace;font-size:14px;border:2px solid #ddd;border-radius:4px;background:#fff;cursor:pointer}.setting-group select:focus{outline:0;border-color:#4a90e2}.setting-group input[type=range]{width:100%;margin-top:5px;cursor:pointer}.model-info{margin-top:10px;padding:8px;background:#e8f5e9;border-radius:4px;display:flex;justify-content:space-between;align-items:center}.info-label{font-size:.8em;font-weight:700;color:#666}.info-value{font-family:'Press Start 2P',cursive;font-size:.6em;color:#ff6b35}.info-value.fast{color:#4caf50}.info-value.medium{color:orange}.info-value.slow{color:#ff6b35}.prompt-preview{background:#2a2a2a;color:#4caf50;padding:15px;border-radius:4px;font-family:'Courier New',monospace;font-size:12px;max-height:400px;overflow-y:auto}.prompt-section{margin-bottom:15px}.prompt-section:last-child{margin-bottom:0}.prompt-label{color:#ff6b35;font-weight:700;margin-bottom:5px;font-size:10px;text-transform:uppercase}.prompt-preview pre{margin:0;white-space:pre-wrap;word-wrap:break-word;color:#4caf50;font-family:'Courier New',monospace;font-size:11px;line-height:1.4}.modal-footer{background:#fff;border-top:3px solid #2a2a2a;padding:15px 20px;display:flex;justify-content:flex-end;gap:10px}.modal-footer button{min-width:100px}input[type=range]{-webkit-appearance:none;appearance:none;background:0 0;cursor:pointer}input[type=range]::-webkit-slider-track{background:#ddd;border:2px solid #2a2a2a;border-radius:4px;height:8px}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;background:#4a90e2;border:2px solid #2a2a2a;border-radius:50%;width:20px;height:20px;margin-top:-8px}input[type=range]::-moz-range-track{background:#ddd;border:2px solid #2a2a2a;border-radius:4px;height:8px}input[type=range]::-moz-range-thumb{background:#4a90e2;border:2px solid #2a2a2a;border-radius:50%;width:20px;height:20px;cursor:pointer}input[type=range]:hover::-webkit-slider-thumb{background:#ff6b35}input[type=range]:hover::-moz-range-thumb{background:#ff6b35}.debug-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.8);z-index:4000;justify-content:center;align-items:center}.debug-modal.active{display:flex;animation:.2s ease-out fadeIn}.debug-modal .modal-content{background:beige;border:4px solid #2a2a2a;border-radius:8px;width:90%;max-width:1200px;height:80vh;display:flex;flex-direction:column;box-shadow:8px 8px 0 #4a90e2,16px 16px 0 #ff6b35}.debug-content{background:#2a2a2a;color:#4caf50;padding:20px;height:100%;overflow-y:auto;font-family:'Courier New',monospace;font-size:12px}.debug-entry{margin-bottom:30px;padding-bottom:20px;border-bottom:2px dashed #4a90e2}.debug-entry:last-child{border-bottom:none}.debug-entry-header{color:#ff6b35;font-weight:700;margin-bottom:10px;font-size:14px}.debug-section{margin-bottom:15px}.debug-label{color:orange;font-weight:700;margin-bottom:5px}.debug-request{background:#1a1a1a;border:1px solid #4a90e2;padding:10px;border-radius:4px;white-space:pre-wrap;word-wrap:break-word;max-height:300px;overflow-y:auto}.debug-response{background:#1a1a1a;border:1px solid #4caf50;padding:10px;border-radius:4px;white-space:pre-wrap;word-wrap:break-word}.debug-metadata{color:#888;font-size:11px;margin-top:5px}.debug-placeholder{color:#888;text-align:center;padding:40px;font-style:italic}.debug-action{color:#ffeb3b;font-weight:700;display:inline-block;background:#333;padding:2px 8px;border-radius:4px;margin-left:10px}</style><div class="scanlines"></div><div class="loading-overlay" id="loading"><div class="loading-text">LOADING MODEL...</div><div class="spinner"></div></div><div class="message-box" id="message-box"><div class="message-title" id="message-title">WELCOME</div><div class="message-content" id="message-content"></div><button onclick="closeMessage()">START MISSION</button></div><div class="settings-modal" id="settings-modal"><div class="modal-content"><div class="modal-header"><h2>MODEL SETTINGS</h2><button onclick="closeSettings()" class="close-btn">×</button></div><div class="modal-body"><div class="settings-column"><div class="setting-group"><label for="model-select">MODEL</label> <select id="model-select"><option value="deepseek">DeepSeek-R1-Distill-Llama-8B<option value="llama">Llama-3.2-3B-Instruct<option value="gemma">Gemma-2B-Instruct<option value="phi">Phi-3.5-Mini-Instruct<option value="tinyllama">TinyLlama-1.1B-Chat</select><div class="model-info"><span class="info-label">SPEED:</span> <span id="model-speed" class="info-value">SLOW</span></div></div><div class="setting-group"><label for="temperature">TEMPERATURE: <span id="temp-value">0.7</span></label> <input id="temperature" max="2" min="0" step="0.1" type="range" value="0.7"></div><div class="setting-group"><label for="max-tokens">MAX TOKENS: <span id="tokens-value">3000</span></label> <input id="max-tokens" max="5000" min="100" step="100" type="range" value="3000"></div><div class="setting-group"><label for="context-window">CONTEXT WINDOW: <span id="context-value">4096</span></label> <input id="context-window" max="8192" min="1024" step="512" type="range" value="4096"></div><div class="setting-group"><label for="system-prompt-input">SYSTEM PROMPT</label> <textarea id="system-prompt-input" style="width:100%;min-height:100px;font-family:'Courier New',monospace;font-size:.8em;padding:8px;border:1px solid #333;background:#1a1a1a;color:#4a90e2;resize:vertical">You are a maze navigation agent. You will analyze the current vision and follow the given strategy to choose an action.
Output your final decision as: {"action": "FORWARD"} or {"action": "LEFT"} or {"action": "RIGHT"} or {"action": "BACKWARD"}</textarea></div></div></div><div class="modal-footer"><button onclick="applySettings()" class="success">APPLY</button> <button onclick="closeSettings()">CANCEL</button></div></div></div><div class="settings-modal" id="how-to-play-modal"><div class="modal-content" style="max-width:800px"><div class="modal-header"><h2>HOW TO PLAY AGENT JOE</h2><button onclick="closeHowToPlay()" class="close-btn">×</button></div><div class="modal-body"><div class="setting-group"><h3 style="color:#ff6b35;margin-bottom:15px">Your Mission</h3><p style="line-height:1.6;margin-bottom:15px">You are training Agent Joe, a robot powered by language models, to navigate through mazes. Your job is to write prompts that tell Joe how to make decisions at each step. The better your prompt, the smarter Joe becomes!<h3 style="color:#ff6b35;margin-bottom:15px;margin-top:20px">How It Works</h3><ol style="line-height:1.8;margin-left:20px"><li><strong>Joe can see in 4 directions:</strong> Front, Right, Left, and Behind<li><strong>Joe can move in 4 ways:</strong> FORWARD, RIGHT, LEFT, or BACKWARD<li><strong>Joe sees 3 things:</strong> "wall" (can't go), "empty" (can go), or "exit" (the goal!)<li><strong>Your prompt tells Joe the rules</strong> for choosing which direction to move</ol><h3 style="color:#ff6b35;margin-bottom:15px;margin-top:20px">Writing Your Prompt</h3><p style="line-height:1.6;margin-bottom:10px">You can write simple rules or complex templates. Use variables to access game state:<ul style="line-height:1.6;margin-left:20px"><li><code>{vision.front}</code>, <code>{vision.right}</code>, etc. - What Joe sees<li><code>{previousActions}</code> - Joe's recent moves and what he saw<li><code>{direction}</code>, <code>{position}</code> - Where Joe is and which way he's facing</ul><p style="margin-top:10px">Click <strong>VARIABLES</strong> button for the full list and examples!<h3 style="color:#ff6b35;margin-bottom:15px;margin-top:20px">Controls</h3><ul style="line-height:1.8;margin-left:20px"><li><strong>START:</strong> Joe follows your prompt continuously until he finds the exit<li><strong>STEP:</strong> Joe makes one move at a time (good for testing)<li><strong>PAUSE:</strong> Pause Joe mid-navigation<li><strong>RESET:</strong> Start over with a new maze<li><strong>SETTINGS:</strong> Change models and parameters</ul><h3 style="color:#ff6b35;margin-bottom:15px;margin-top:20px">Pro Tips</h3><ul style="line-height:1.6;margin-left:20px"><li>Start simple! Try: "If Front is empty, go FORWARD. Otherwise, turn RIGHT."<li>Use STEP mode to debug why Joe makes certain decisions<li>Check the Debug View to see exactly what the language model is thinking</ul></div></div><div class="modal-footer"><button onclick="closeHowToPlay()">LET'S PLAY!</button></div></div></div><div class="settings-modal" id="template-help-modal"><div class="modal-content" style="max-width:700px"><div class="modal-header"><h2>PROMPT VARIABLES</h2><button onclick="closeTemplateHelp()" class="close-btn">×</button></div><div class="modal-body"><div class="setting-group"><p><strong>You can use these variables in your navigation prompt:</strong><h4 style="color:#4a90e2;margin-top:15px">Available Variables:</h4><ul style="font-size:.9em;line-height:1.8;margin-left:20px"><li><code>{vision}</code> - Full vision (Front=X, Right=Y, Left=Z, Behind=W)<li><code>{vision.front}</code> - What's in front (wall/empty/exit)<li><code>{vision.right}</code> - What's to the right<li><code>{vision.left}</code> - What's to the left<li><code>{vision.behind}</code> - What's behind<li><code>{direction}</code> - Current facing direction (NORTH/SOUTH/EAST/WEST)<li><code>{position}</code> - Current position as (x, y)<li><code>{position.x}</code> - X coordinate<li><code>{position.y}</code> - Y coordinate<li><code>{moveCount}</code> - Total number of moves made<li><code>{previousActions}</code> - Last 5 moves with vision and actions taken</ul><h4 style="color:#4a90e2;margin-top:20px">Example Template Using All Variables:</h4><div class="prompt-preview" style="margin-top:10px"><pre>&lt;think&gt;
I am at position {position}, facing {direction}.
I've made {moveCount} moves so far.
My current coordinates are: X={position.x}, Y={position.y}

Current vision: {vision}
Breaking it down:
- Front: {vision.front}
- Right: {vision.right}
- Left: {vision.left}
- Behind: {vision.behind}

Move history:
{previousActions}
&lt;/think&gt;

Analyze the maze state and choose your next action.</pre></div><h4 style="color:#4a90e2;margin-top:20px">Example With Filled Values:</h4><div class="prompt-preview" style="margin-top:10px;background:#1a1a1a"><pre style="color:#888;font-size:.9em">&lt;think&gt;
I am at position (3, 5), facing NORTH.
I've made 12 moves so far.
My current coordinates are: X=3, Y=5

Current vision: Front=wall, Right=empty, Left=empty, Behind=empty
Breaking it down:
- Front: wall
- Right: empty
- Left: empty
- Behind: empty

Move history:
Recent 3 moves (newest first):
[1] Saw: Front=empty, Right=wall, Left=empty, Behind=wall → Action: FORWARD
[2] Saw: Front=empty, Right=wall, Left=wall, Behind=empty → Action: FORWARD
[3] Saw: Front=wall, Right=empty, Left=wall, Behind=empty → Action: RIGHT
&lt;/think&gt;

Analyze the maze state and choose your next action.</pre></div><p style="margin-top:15px;font-size:.9em;color:#666"><strong>Note:</strong> Variables are replaced with actual values before being sent to the model. You can write simple navigation rules or create complex templates using any combination of these variables.</div></div><div class="modal-footer"><button onclick="closeTemplateHelp()">CLOSE</button></div></div></div><div class="message-box" id="maze-help-modal"><div class="message-title">MAZE AREA</div><div class="message-content"><p><strong>This is where Agent Joe navigates!</strong></p><br><ul style="text-align:left;line-height:1.6"><li><strong>Joe (orange figure)</strong> - Your agent powered by language models<li><strong>Black walls</strong> - Joe cannot pass through these<li><strong>White spaces</strong> - Joe can move here<li><strong>Blue trail</strong> - Shows where Joe has been<li><strong>Green smiley</strong> - The exit Joe needs to find!</ul><br><p>Joe always starts at the top-left corner facing down (SOUTH).<p>The maze changes each time you press RESET.</div><button onclick="closeMazeHelp()">GOT IT!</button></div><div class="message-box" id="status-help-modal"><div class="message-title">STATUS PANEL</div><div class="message-content"><p><strong>Shows Joe's current state:</strong></p><br><ul style="text-align:left;line-height:1.6"><li><strong>Direction:</strong> Which way Joe is facing (NORTH/SOUTH/EAST/WEST)<li><strong>Moves:</strong> Total number of moves Joe has made<li><strong>Status:</strong> What Joe is doing (READY/THINKING/MOVING/PAUSED)<li><strong>Time:</strong> How long Joe has been navigating</ul></div><button onclick="closeStatusHelp()">GOT IT!</button></div><div class="message-box" id="vision-help-modal"><div class="message-title">VISION PANEL</div><div class="message-content"><p><strong>Shows what Joe sees around him:</strong></p><br><p>The 3x3 grid represents Joe's view:<ul style="text-align:left;line-height:1.6"><li><strong>Top cell:</strong> What's in FRONT<li><strong>Right cell:</strong> What's to the RIGHT<li><strong>Left cell:</strong> What's to the LEFT<li><strong>Bottom cell:</strong> What's BEHIND<li><strong>Center:</strong> Joe's position</ul></div><button onclick="closeVisionHelp()">GOT IT!</button></div><div class="debug-modal" id="debug-modal"><div class="modal-content"><div class="modal-header"><h2>DEBUG VIEW - LLM INTERACTIONS</h2><button onclick="closeDebugView()" class="close-btn">×</button></div><div class="modal-body"><div class="debug-content" id="debug-content"><div class="debug-placeholder">No LLM interactions yet. Start navigating to see debug information.</div></div></div><div class="modal-footer"><button onclick="clearDebugLog()">CLEAR LOG</button> <button onclick="copyDebugLog()">COPY ALL</button> <button onclick="closeDebugView()">CLOSE</button></div></div></div><div class="container"><div class="header"><h1>AGENT JOE</h1></div><div class="game-layout" style="flex-direction:column"><div style="width:100%;max-width:600px"><button onclick="showHowToPlay()" style="font-size:.9em;padding:10px 20px;background:#4caf50">HOW TO PLAY?</button></div><div style="display:flex;gap:25px;align-items:flex-start;justify-content:center"><div class="maze-container"><div class="maze-wrapper" style="position:relative"><canvas height="360" id="maze-canvas" width="360"></canvas><button onclick="showMazeHelp()" style="position:absolute;top:10px;right:10px;min-width:30px;max-width:30px;width:30px;height:30px;padding:0;background:#4a90e2;border:2px solid #2a2a2a;border-radius:50%;font-size:14px;cursor:pointer;color:#fff;font-family:'Press Start 2P',cursive;line-height:1;box-shadow:2px 2px 0 #2a2a2a;transition:all .2s" onmouseout="this.style.transform='translate(0, 0)'; this.style.boxShadow='2px 2px 0px #2a2a2a';" onmouseover="this.style.transform='translate(-1px, -1px)'; this.style.boxShadow='3px 3px 0px #2a2a2a';">?</button></div><div class="bottom-panels"><div class="panel compact"><div class="panel-title" style="display:flex;align-items:center;justify-content:space-between"><span>STATUS</span> <button onclick="showStatusHelp()" style="min-width:20px;max-width:20px;width:20px;height:20px;padding:0;background:#4a90e2;border:2px solid #2a2a2a;border-radius:50%;font-size:10px;cursor:pointer;color:#fff;font-weight:700;line-height:1;box-shadow:1px 1px 0 #2a2a2a;transition:all .2s;flex:0 0 20px" onmouseout="this.style.transform='translate(0, 0)'; this.style.boxShadow='1px 1px 0px #2a2a2a';" onmouseover="this.style.transform='translate(-1px, -1px)'; this.style.boxShadow='2px 2px 0px #2a2a2a';">?</button></div><div class="status-grid"><div class="status-item"><div class="status-label">Direction</div><div class="status-value" id="direction">NORTH</div></div><div class="status-item"><div class="status-label">Moves</div><div class="status-value" id="moves">0</div></div><div class="status-item"><div class="status-label">Status</div><div class="status-value" id="status">READY</div></div><div class="status-item"><div class="status-label">Time</div><div class="status-value" id="timer">0:00</div></div></div></div><div class="panel compact"><div class="panel-title" style="display:flex;align-items:center;justify-content:space-between"><span>VISION</span> <button onclick="showVisionHelp()" style="min-width:20px;max-width:20px;width:20px;height:20px;padding:0;background:#4a90e2;border:2px solid #2a2a2a;border-radius:50%;font-size:10px;cursor:pointer;color:#fff;font-weight:700;line-height:1;box-shadow:1px 1px 0 #2a2a2a;transition:all .2s;flex:0 0 20px" onmouseout="this.style.transform='translate(0, 0)'; this.style.boxShadow='1px 1px 0px #2a2a2a';" onmouseover="this.style.transform='translate(-1px, -1px)'; this.style.boxShadow='2px 2px 0px #2a2a2a';">?</button></div><div class="vision-display" id="vision-display"><div class="vision-cell empty">?</div><div class="vision-cell empty">↑</div><div class="vision-cell empty">?</div><div class="vision-cell empty">←</div><div class="vision-cell joe">JOE</div><div class="vision-cell empty">→</div><div class="vision-cell empty">?</div><div class="vision-cell empty">↓</div><div class="vision-cell empty">?</div></div></div></div></div><div class="control-panel"><div class="panel"><div class="panel-title"><span>PROMPT</span><div style="margin-left:auto;display:flex;gap:10px;align-items:center"><button onclick="showTemplateHelp()" style="font-size:.7em;padding:4px 8px" title="View available variables">VARIABLES</button> <button onclick="openSettings()" style="font-size:.7em;padding:4px 8px">SETTINGS</button></div></div><textarea id="prompt-input" placeholder="Write your complete prompt template here. You must include all context the agent needs!

TIP: Use template variables to include game state:
• {vision.front}, {vision.right}, {vision.left}, {vision.behind} - What Joe sees
• {previousActions} - History of recent moves
• {direction}, {position}, {moveCount} - Current state

Click VARIABLES button above to see all available variables and complete examples."></textarea><div class="button-container"><button onclick="startNavigation()" class="success" id="start-button">START</button> <button onclick="stepOnce()" id="step-button">STEP</button> <button onclick="pauseNavigation()" id="pause-button" disabled="disabled">PAUSE</button> <button onclick="resetMaze()" class="danger">RESET</button></div></div><div class="panel"><div class="panel-title"><span>MOVE HISTORY</span><div style="margin-left:auto;display:flex;gap:8px"><button onclick="copyHistory()" style="font-size:.7em;padding:4px 8px">COPY</button> <button onclick="openDebugView()" style="font-size:.7em;padding:4px 8px" title="Debug View">DEBUG</button></div></div><div class="move-history" id="move-history"><div class="move-item">Waiting for navigation to begin...</div></div></div></div></div></div></div><script type="module">import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";
(async function() {
window.PerformanceOptimizer=class{constructor(){this.lastGCTime=Date.now(),this.moveBuffer=[],this.isProcessing=!1,this.gcInterval=5e3,this.maxHistorySize=20}throttle(t,e){let i,s=0;return function(...o){const n=Date.now();return n-s>e?(s=n,t.apply(this,o)):(clearTimeout(i),new Promise(r=>{i=setTimeout(()=>{s=Date.now(),r(t.apply(this,o))},e-(n-s))}))}}performGarbageCollection(){const t=Date.now();t-this.lastGCTime>this.gcInterval&&(window.moveHistory&&window.moveHistory.length>this.maxHistorySize&&(window.moveHistory=window.moveHistory.slice(-this.maxHistorySize)),window.debugLog&&window.debugLog.length>30&&(window.debugLog=window.debugLog.slice(-30)),this.lastGCTime=t)}async batchMoves(t,e=3){const i=`Generate the next ${e} moves as a comma-separated list. Example: "FORWARD,RIGHT,FORWARD"`;try{return(await t(i)).split(",").map(t=>t.trim())}catch(t){return[]}}optimizeNavigationLoop(t){return async function(){if(this.performGarbageCollection(),!this.isProcessing){this.isProcessing=!0;try{await t()}finally{this.isProcessing=!1}}}.bind(this)}createCancellableRequest(t){let e;const i=new Promise((i,s)=>{e=()=>s(Error("Request cancelled")),t.then(i).catch(s)});return i.cancel=e,i}compressHistory(t){return t.map(t=>({m:t.move?.substring(0,1),p:`${t.position?.x},${t.position?.y}`,d:t.direction?.substring(0,1)}))}decompressHistory(t){const e={N:"NORTH",S:"SOUTH",E:"EAST",W:"WEST"},i={F:"FORWARD",B:"BACKWARD",L:"LEFT",R:"RIGHT"};return t.map(t=>{const[s,o]=t.p.split(",").map(Number);return{move:i[t.m]||t.m,position:{x:s,y:o},direction:e[t.d]||t.d}})}};
!function(){function e(){const e=document.getElementById("model-select").value,t=document.getElementById("model-speed"),n=modelConfigs[e];t.textContent=n.speed,t.className="info-value "+n.speedClass,document.getElementById("temperature").dataset.userModified||(document.getElementById("temperature").value=n.defaultTemp,document.getElementById("temp-value").textContent=n.defaultTemp),document.getElementById("max-tokens").dataset.userModified||(document.getElementById("max-tokens").value=n.defaultTokens,document.getElementById("tokens-value").textContent=n.defaultTokens),document.getElementById("context-window").dataset.userModified||(document.getElementById("context-window").value=n.defaultContext,document.getElementById("context-value").textContent=n.defaultContext)}window.modelConfigs={deepseek:{name:"DeepSeek-R1-Distill-Llama-8B-q4f32_1-MLC",speed:"SLOW",speedClass:"slow",defaultTemp:.7,defaultTokens:3e3,defaultContext:4096},llama:{name:"Llama-3.2-3B-Instruct-q4f16_1-MLC",speed:"FAST",speedClass:"fast",defaultTemp:.7,defaultTokens:500,defaultContext:4096},gemma:{name:"gemma-2-2b-it-q4f16_1-MLC",speed:"FAST",speedClass:"fast",defaultTemp:.7,defaultTokens:500,defaultContext:4096},phi:{name:"Phi-3.5-mini-instruct-q4f16_1-MLC",speed:"MEDIUM",speedClass:"medium",defaultTemp:.7,defaultTokens:500,defaultContext:4096},tinyllama:{name:"TinyLlama-1.1B-Chat-v1.0-q4f16_1-MLC-1k",speed:"VERY FAST",speedClass:"fast",defaultTemp:.7,defaultTokens:500,defaultContext:1024}},window.currentModel="deepseek",window.modelSettings={temperature:.7,maxTokens:3e3,contextWindow:4096,systemPrompt:'You are a maze navigation AI. You will analyze the current vision and follow the given strategy to choose an action.\nOutput your final decision as: {"action": "FORWARD"} or {"action": "LEFT"} or {"action": "RIGHT"} or {"action": "BACKWARD"}'},window.currentModel=window.currentModel,window.modelSettings=window.modelSettings,window.openSettings=function(){document.getElementById("settings-modal").classList.add("active"),document.getElementById("model-select").value=currentModel,document.getElementById("temperature").value=modelSettings.temperature,document.getElementById("temp-value").textContent=modelSettings.temperature,document.getElementById("max-tokens").value=modelSettings.maxTokens,document.getElementById("tokens-value").textContent=modelSettings.maxTokens,document.getElementById("context-window").value=modelSettings.contextWindow,document.getElementById("context-value").textContent=modelSettings.contextWindow,e(),updatePromptPreview()},window.closeSettings=function(){document.getElementById("settings-modal").classList.remove("active")},window.applySettings=async function(){const e=document.getElementById("model-select").value,t=e!==window.currentModel;if(window.modelSettings.temperature=parseFloat(document.getElementById("temperature").value),window.modelSettings.maxTokens=parseInt(document.getElementById("max-tokens").value),window.modelSettings.contextWindow=parseInt(document.getElementById("context-window").value),window.modelSettings.systemPrompt=document.getElementById("system-prompt-input").value,t){if(!confirm("WARNING: Changing the model will reset the entire game!\n\nThe maze will be regenerated and all progress will be lost.\n\nAre you sure you want to continue?"))return void(document.getElementById("model-select").value=window.currentModel);window.currentModel=e,currentModel=e,closeSettings(),window.resetMaze&&window.resetMaze(),window.reloadModel&&await window.reloadModel(window.currentModel)}else closeSettings()},window.updatePromptPreview=function(){const e=document.getElementById("prompt-input").value||"[Your navigation instructions]",t=document.getElementById("system-prompt-input"),n=t?t.value:window.modelSettings.systemPrompt;currentModel,document.getElementById("system-prompt-preview").textContent=n,document.getElementById("user-prompt-preview").textContent=e,document.getElementById("context-preview").textContent="Current Vision:\nFront=empty, Left=wall, Right=empty, Behind=wall\n\nRecent moves (newest first):\n[1] Saw: Front=wall, Left=empty, Right=wall, Behind=empty \u2192 Moved: LEFT\n[2] Saw: Front=empty, Left=wall, Right=empty, Behind=wall \u2192 Moved: FORWARD"},document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("model-select");t&&(t.value=window.currentModel,e(),t.addEventListener("change",function(){e(),updatePromptPreview()}));const n=document.getElementById("temperature");n&&n.addEventListener("input",function(){document.getElementById("temp-value").textContent=this.value,this.dataset.userModified="true"});const o=document.getElementById("max-tokens");o&&o.addEventListener("input",function(){document.getElementById("tokens-value").textContent=this.value,this.dataset.userModified="true"});const d=document.getElementById("context-window");d&&d.addEventListener("input",function(){document.getElementById("context-value").textContent=this.value,this.dataset.userModified="true"});const i=document.getElementById("prompt-input");i&&i.addEventListener("input",function(){document.getElementById("settings-modal").classList.contains("active")&&updatePromptPreview()});const m=document.getElementById("system-prompt-input");m&&m.addEventListener("input",function(){document.getElementById("settings-modal").classList.contains("active")&&updatePromptPreview()});const u=document.getElementById("settings-modal");u&&u.addEventListener("click",function(e){e.target===u&&closeSettings()})})}();
window.LLMWorkerManager=class{constructor(){this.worker=null,this.messageQueue=[],this.messageCallbacks=new Map,this.messageId=0,this.initPromise=null}async init(){if(!this.worker)return new Promise((e,s)=>{try{this.worker=new Worker("./llm-worker.js",{type:"module"}),this.worker.addEventListener("message",e=>{this.handleWorkerMessage(e.data)}),this.worker.addEventListener("error",e=>{s(e)}),this.worker.addEventListener("message",s=>{"ready"===s.data.type&&e()},{once:!0})}catch(e){s(e)}})}async initializeModel(e,s){return this.worker||await this.init(),new Promise((t,i)=>{const r=this.messageId++;this.messageCallbacks.set(r,{resolve:t,reject:i,progressCallback:s}),this.worker.postMessage({type:"initialize",messageId:r,payload:{modelId:e}})})}async generateCompletion(e,s=.7,t=500){if(!this.worker)throw Error("Worker not initialized");return new Promise((i,r)=>{const o=this.messageId++;this.messageCallbacks.set(o,{resolve:i,reject:r}),this.worker.postMessage({type:"generate",messageId:o,payload:{messages:e,temperature:s,maxTokens:t}}),setTimeout(()=>{this.messageCallbacks.has(o)&&(this.messageCallbacks.delete(o),r(Error("Generation timeout")))},3e4)})}handleWorkerMessage(e){const{type:s,messageId:t,success:i,data:r,error:o}=e;if("initProgress"===s){const e=this.messageCallbacks.get(t);return void(e&&e.progressCallback&&e.progressCallback(r))}const n=this.messageCallbacks.get(t);n&&(i?n.resolve(r):n.reject(Error(o||"Worker operation failed")),this.messageCallbacks.delete(t))}async reset(){if(this.worker)return new Promise(e=>{const s=this.messageId++;this.messageCallbacks.set(s,{resolve:e}),this.worker.postMessage({type:"reset",messageId:s})})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null,this.messageCallbacks.clear())}},window.LLMWorkerManager=LLMWorkerManager;
!function(){const t=window.PerformanceOptimizer?new window.PerformanceOptimizer:null;let n=null,e=!1,o=!1,i=[],a={x:1,y:1},c="SOUTH",s=0,d=[],u=60,r=[],l=null,m="",f=[],v=null,g=null,w=0,p=null,T=[],h=0,R=!1;const b={NORTH:{x:0,y:-1,symbol:"\u2191"},EAST:{x:1,y:0,symbol:"\u2192"},SOUTH:{x:0,y:1,symbol:"\u2193"},WEST:{x:-1,y:0,symbol:"\u2190"}};function E(){d=[,,,,,,,,,].fill().map(()=>[,,,,,,,,,].fill(1)),d=[[1,1,1,1,1,1,1,1,1],[1,0,0,0,1,0,0,0,1],[1,0,0,0,0,0,1,0,1],[1,0,1,1,1,1,1,0,1],[1,0,0,0,0,0,0,0,1],[1,0,0,0,1,0,1,1,1],[1,0,0,0,1,0,0,0,1],[1,0,0,1,1,1,1,0,2],[1,1,1,1,1,1,1,1,1]],a={x:1,y:1},r=[]}function y(){const t=document.getElementById("maze-canvas"),n=t.getContext("2d");t.width=540,t.height=540,n.fillStyle="#fafafa",n.fillRect(0,0,t.width,t.height);for(let t=0;9>t;t++)for(let e=0;9>e;e++){const o=d[t][e];if(1===o)n.fillStyle="#2a2a2a",n.fillRect(e*u,t*u,u,u);else if(2===o){const o=n.createLinearGradient(e*u,t*u,(e+1)*u,(t+1)*u);o.addColorStop(0,"#4caf50"),o.addColorStop(1,"#8bc34a"),n.fillStyle=o,n.fillRect(e*u,t*u,u,u);const i=e*u+30,a=t*u+30;n.fillStyle="#fff",n.fillRect(i-8,a-8,3,3),n.fillRect(i+5,a-8,3,3),n.fillRect(i-10,a+4,3,3),n.fillRect(i-5,a+7,3,3),n.fillRect(i,a+8,3,3),n.fillRect(i+5,a+7,3,3),n.fillRect(i+8,a+4,3,3)}n.strokeStyle="#e0e0e0",n.strokeRect(e*u,t*u,u,u)}n.fillStyle="rgba(74, 144, 226, 0.3)";for(const t of r)n.fillRect(t.x*u+5,t.y*u+5,50,50);!function(t){const n=a.x*u+30,e=a.y*u+30;switch(t.save(),t.translate(n,e),c){case"NORTH":!function(t){t.fillStyle="#ff6b35",t.fillRect(-9,-9,18,6),t.fillStyle="#3a2a1a",t.fillRect(-9,-3,18,3),t.fillStyle="#fdbcb4",t.fillRect(-3,0,6,3),t.fillStyle="#f0f0f0",t.fillRect(-9,3,18,9),t.strokeStyle="#d0d0d0",t.lineWidth=1,t.strokeRect(-9,3,18,9),t.fillStyle="#f0f0f0",t.fillRect(-12,6,3,6),t.fillRect(9,6,3,6),t.strokeRect(-12,6,3,6),t.strokeRect(9,6,3,6),t.fillStyle="#4a90e2",t.fillRect(-6,12,12,6),t.fillRect(-6,18,3,6),t.fillRect(3,18,3,6),t.fillStyle="#000",t.fillRect(-6,24,3,3),t.fillRect(3,24,3,3)}(t);break;case"SOUTH":!function(t){t.fillStyle="#ff6b35",t.fillRect(-9,-9,18,3),t.fillRect(-6,-12,12,6),t.fillStyle="#3a2a1a",t.fillRect(-9,-6,3,3),t.fillRect(6,-6,3,3),t.fillStyle="#fdbcb4",t.fillRect(-6,-6,12,9),t.fillStyle="#000",t.fillRect(-3,-3,1.5,1.5),t.fillRect(1.5,-3,1.5,1.5),t.fillRect(-1.5,1.5,3,1),t.fillStyle="#f0f0f0",t.fillRect(-9,3,18,9),t.strokeStyle="#d0d0d0",t.lineWidth=1,t.strokeRect(-9,3,18,9),t.fillStyle="#d0d0d0",t.fillRect(-6,6,3,3),t.fillStyle="#f0f0f0",t.fillRect(-12,6,3,6),t.fillRect(9,6,3,6),t.strokeRect(-12,6,3,6),t.strokeRect(9,6,3,6),t.fillStyle="#fdbcb4",t.fillRect(-12,12,3,3),t.fillRect(9,12,3,3),t.fillStyle="#4a90e2",t.fillRect(-6,12,12,6),t.fillRect(-6,18,3,6),t.fillRect(3,18,3,6),t.fillStyle="#000",t.fillRect(-6,24,3,3),t.fillRect(3,24,3,3)}(t);break;case"EAST":!function(t){t.fillStyle="#ff6b35",t.fillRect(-3,-9,9,6),t.fillRect(-3,-6,12,3),t.fillStyle="#3a2a1a",t.fillRect(-6,-3,3,3),t.fillStyle="#fdbcb4",t.fillRect(-3,-3,9,9),t.fillStyle="#000",t.fillRect(3,0,1.5,1.5),t.fillStyle="#f0f0f0",t.fillRect(-6,3,12,9),t.strokeStyle="#d0d0d0",t.lineWidth=1,t.strokeRect(-6,3,12,9),t.fillStyle="#f0f0f0",t.fillRect(6,6,3,6),t.strokeRect(6,6,3,6),t.fillStyle="#fdbcb4",t.fillRect(6,12,3,3),t.fillStyle="#4a90e2",t.fillRect(-3,12,9,6),t.fillRect(0,18,6,6),t.fillStyle="#000",t.fillRect(3,24,6,3)}(t);break;case"WEST":!function(t){t.fillStyle="#ff6b35",t.fillRect(-6,-9,9,6),t.fillRect(-9,-6,12,3),t.fillStyle="#3a2a1a",t.fillRect(3,-3,3,3),t.fillStyle="#fdbcb4",t.fillRect(-6,-3,9,9),t.fillStyle="#000",t.fillRect(-3,0,1.5,1.5),t.fillStyle="#f0f0f0",t.fillRect(-6,3,12,9),t.strokeStyle="#d0d0d0",t.lineWidth=1,t.strokeRect(-6,3,12,9),t.fillStyle="#f0f0f0",t.fillRect(-9,6,3,6),t.strokeRect(-9,6,3,6),t.fillStyle="#fdbcb4",t.fillRect(-9,12,3,3),t.fillStyle="#4a90e2",t.fillRect(-6,12,9,6),t.fillRect(-6,18,6,6),t.fillStyle="#000",t.fillRect(-9,24,6,3)}(t)}t.restore()}(n)}function O(){const t={front:"unknown",left:"unknown",right:"unknown",behind:"unknown",current:"empty"},n={NORTH:{front:"NORTH",left:"WEST",right:"EAST",behind:"SOUTH"},EAST:{front:"EAST",left:"NORTH",right:"SOUTH",behind:"WEST"},SOUTH:{front:"SOUTH",left:"EAST",right:"WEST",behind:"NORTH"},WEST:{front:"WEST",left:"SOUTH",right:"NORTH",behind:"EAST"}}[c];for(const[e,o]of Object.entries(n)){const n={x:a.x+b[o].x,y:a.y+b[o].y};if(n.x>=0&&9>n.x&&n.y>=0&&9>n.y){const o=d[n.y][n.x];t[e]=1===o?"wall":2===o?"exit":"empty"}else t[e]="wall"}return t}function S(){const t=O(),n=document.getElementById("vision-display"),e=[{type:"corner",value:""},{type:t.front,value:"\u2191"},{type:"corner",value:""},{type:t.left,value:"\u2190"},{type:"joe",value:"JOE"},{type:t.right,value:"\u2192"},{type:"corner",value:""},{type:t.behind,value:"\u2193"},{type:"corner",value:""}];n.innerHTML=e.map(t=>{let n="vision-cell";return"wall"===t.type?n+=" wall":"empty"===t.type?n+=" empty":"joe"===t.type?n+=" joe":"exit"===t.type&&(n+=" exit"),`<div class="${n}">${t.value}</div>`}).join("")}function A(t=null){const n=document.getElementById("direction"),i=document.getElementById("moves"),a=document.getElementById("status");if(!n||!i||!a)return;n.textContent=c,i.textContent=s;let d="READY";t?d=t:e&&(d=o?"PAUSED":"MOVING"),a.textContent=d,C()}function $(t,n=!0){const e=document.getElementById("move-history"),o=document.createElement("div");o.className=n?"move-item":"move-item error",o.textContent=`[${s}] ${t}`,e.appendChild(o),e.scrollTop=e.scrollHeight,i.push({move:t,position:{...a},direction:c})}function N(t){if("FORWARD"===(t=t.toUpperCase().trim())||"MOVE"===t){const t={x:a.x+b[c].x,y:a.y+b[c].y};if(t.x>=0&&9>t.x&&t.y>=0&&9>t.y&&1!==d[t.y][t.x]){if(r.push({...a}),a=t,s++,$(`Moved forward to (${t.x}, ${t.y})`),2===d[t.y][t.x])return I(),!0}else $("Cannot move forward - blocked!",!1)}else if("LEFT"===t||"TURN_LEFT"===t){const t=["NORTH","WEST","SOUTH","EAST"],n=t.indexOf(c);c=t[(n+1)%4],s++,$("Turned left, now facing "+c)}else if("RIGHT"===t||"TURN_RIGHT"===t){const t=["NORTH","EAST","SOUTH","WEST"],n=t.indexOf(c);c=t[(n+1)%4],s++,$("Turned right, now facing "+c)}else"BACKWARD"===t||"BACK"===t?(c={NORTH:"SOUTH",SOUTH:"NORTH",EAST:"WEST",WEST:"EAST"}[c],s++,$("Turned around, now facing "+c)):$("Unknown action: "+t,!1);return y(),A(),S(),!1}function D(t,n,e){return t.replace(/\{vision\.front\}/g,n.front).replace(/\{vision\.right\}/g,n.right).replace(/\{vision\.left\}/g,n.left).replace(/\{vision\.behind\}/g,n.behind).replace(/\{vision\}/g,`Front=${n.front}, Right=${n.right}, Left=${n.left}, Behind=${n.behind}`).replace(/\{position\.x\}/g,a.x).replace(/\{position\.y\}/g,a.y).replace(/\{position\}/g,`(${a.x}, ${a.y})`).replace(/\{direction\}/g,c).replace(/\{moveCount\}/g,s).replace(/\{previousActions\}/g,e)}async function H(t){const e=O();let o=null;try{let i,a="";if(f.length>0){const t=Math.min(5,f.length);a="Recent moves (newest first):\n";for(let n=f.length-1;n>=Math.max(0,f.length-t);n--){const t=f[n];a+=`[${f.length-n}] Saw: Front=${t.vision.front}, Right=${t.vision.right}, Left=${t.vision.left}, Behind=${t.vision.behind} \u2192 Action: ${t.action}\n`}}else a="";if("deepseek"===window.currentModel){i=[{role:"system",content:window.modelSettings.systemPrompt}];const n=D(t,e,a);i.push({role:"user",content:n})}else{i=[{role:"system",content:window.modelSettings.systemPrompt}];const n=D(t,e,a);i.push({role:"user",content:n})}o={timestamp:(new Date).toLocaleTimeString(),moveNumber:s+1,vision:e,request:{messages:JSON.parse(JSON.stringify(i)),temperature:window.modelSettings.temperature,maxTokens:window.modelSettings.maxTokens,model:window.currentModel},response:{raw:null,action:null}};const c=await n.chat.completions.create({messages:i,temperature:window.modelSettings.temperature,max_tokens:window.modelSettings.maxTokens});o.response.raw=c.choices[0].message.content;let d=c.choices[0].message.content||"";if(d.includes("</think>")){const t=d.split("</think>"),n=t[t.length-1].trim();n&&(d=n)}try{const t=((JSON.parse(d).action||"")+"").toUpperCase();if(["FORWARD","LEFT","RIGHT","BACKWARD"].includes(t))return o&&(o.response.action=t,T.push(o),T.length>50&&(T=T.slice(-50)),document.getElementById("debug-modal")&&document.getElementById("debug-modal").classList.contains("active")&&F()),t}catch(t){try{const t=d.match(/\{[^}]*"action"\s*:\s*"([^"]+)"[^}]*\}/);if(t){const n=t[1].toUpperCase();if(["FORWARD","LEFT","RIGHT","BACKWARD"].includes(n))return o&&(o.response.action=n,T.push(o),T.length>50&&(T=T.slice(-50)),document.getElementById("debug-modal")&&document.getElementById("debug-modal").classList.contains("active")&&F()),n}}catch(t){}}let u=d.toUpperCase();if(!u)return"empty"===e.front?"FORWARD":"empty"===e.right?"RIGHT":"empty"===e.left?"LEFT":"BACKWARD";const r=u.match(/Action:\s*(\w+)/i);if(r){const t=r[1].toUpperCase();if(["FORWARD","LEFT","RIGHT","BACKWARD"].includes(t))return o&&(o.response.action=t,T.push(o),T.length>50&&(T=T.slice(-50)),document.getElementById("debug-modal")&&document.getElementById("debug-modal").classList.contains("active")&&F()),t}const l=u.match(/^(\w+)$/);if(l){const t=l[1].toUpperCase();if(["FORWARD","LEFT","RIGHT","BACKWARD"].includes(t))return o&&(o.response.action=t,T.push(o),T.length>50&&(T=T.slice(-50)),document.getElementById("debug-modal")&&document.getElementById("debug-modal").classList.contains("active")&&F()),t}const m=u.toUpperCase(),v=["FORWARD","LEFT","RIGHT","BACKWARD"];let g=null,w=-1;for(const t of v){const n=m.lastIndexOf(t);n>w&&(w=n,g=t)}if(g)return g;if(m.includes("MOVE"))return"FORWARD";if(m.includes("TURN LEFT"))return"LEFT";if(m.includes("TURN RIGHT"))return"RIGHT";if(m.includes("BACK"))return"BACKWARD";const p=m.split(/[\s,.:;!?'"]+/).filter(t=>t.length>0),h=p[p.length-1];if(v.includes(h))return o&&(o.response.action=h,T.push(o),T.length>50&&(T=T.slice(-50)),document.getElementById("debug-modal")&&document.getElementById("debug-modal").classList.contains("active")&&F()),h;let R=h;return["FORWARD","LEFT","RIGHT","BACKWARD"].includes(h)||(R="empty"===e.front?"FORWARD":"RIGHT"),o&&(o.response.action=R,T.push(o),T.length>50&&(T=T.slice(-50)),document.getElementById("debug-modal")&&document.getElementById("debug-modal").classList.contains("active")&&F()),R}catch(t){return"FORWARD"}}function M(){v=Date.now(),g&&clearInterval(g),g=setInterval(()=>{C()},1e3)}function W(){g&&(clearInterval(g),g=null)}function C(){if(!v)return;let t=Date.now()-v-w;p&&(t-=Date.now()-p);const n=Math.floor(t/1e3),e=Math.floor(n/60),o=n%60;document.getElementById("timer").textContent=`${e}:${o.toString().padStart(2,"0")}`}function I(){stopNavigation();let t="0:00";if(v){const n=Math.floor((Date.now()-v)/1e3);t=`${Math.floor(n/60)}:${(""+n%60).padStart(2,"0")}`}W(),L("SUCCESS!",`Agent Joe found the exit!\n\nMoves taken: ${s}\nTime elapsed: ${t}\n\nYour prompt successfully guided Joe through the maze!\n\nTry to optimize your prompt for fewer moves!`)}function L(t,n){const e=document.getElementById("message-box"),o=document.getElementById("message-title"),i=document.getElementById("message-content");e&&o&&i&&(o.textContent=t,i.textContent=n,e.classList.add("active"))}function F(){const t=document.getElementById("debug-content");t&&(0!==T.length?(t.innerHTML=T.map((t,n)=>{const e=t.request.messages.map(t=>`<div><strong>${t.role}:</strong> ${U(t.content)}</div>`).join("");return`\n            <div class="debug-entry">\n                <div class="debug-entry-header">\n                    Move ${t.moveNumber} - ${t.timestamp}\n                    <span class="debug-action">${t.response.action}</span>\n                </div>\n\n                <div class="debug-section">\n                    <div class="debug-label">VISION:</div>\n                    <div class="debug-metadata">\n                        Front: ${t.vision.front} | Left: ${t.vision.left} |\n                        Right: ${t.vision.right} | Behind: ${t.vision.behind}\n                    </div>\n                </div>\n\n                <div class="debug-section">\n                    <div class="debug-label">REQUEST:</div>\n                    <div class="debug-request">\n                        ${e}\n                        <div class="debug-metadata">\n                            Model: ${t.request.model} |\n                            Temp: ${t.request.temperature} |\n                            Max Tokens: ${t.request.maxTokens}\n                        </div>\n                    </div>\n                </div>\n\n                <div class="debug-section">\n                    <div class="debug-label">RESPONSE:</div>\n                    <div class="debug-response">\n                        ${U(t.response.raw)}\n                    </div>\n                </div>\n            </div>\n        `}).join(""),t.scrollTop=t.scrollHeight):t.innerHTML='<div class="debug-placeholder">No LLM interactions yet. Start navigating to see debug information.</div>')}function U(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}window.startNavigation=async function(){const d=document.getElementById("prompt-input"),u=d.value.trim();u?n?e?L("WARNING","Navigation already in progress!"):(e=!0,o=!1,m=u,R=!0,d.disabled=!0,d.style.cursor="not-allowed",d.style.backgroundColor="#f0f0f0",v||M(),document.getElementById("start-button").disabled=!0,document.getElementById("pause-button").disabled=!1,document.getElementById("step-button").disabled=!0,document.getElementById("move-history").innerHTML="",$("Navigation started!"),(async()=>{for(;e&&e;){if(o){await new Promise(t=>setTimeout(t,100));continue}t&&t.performGarbageCollection();const n=Date.now()-h;if(500>n&&await new Promise(t=>setTimeout(t,500-n)),s>200){stopNavigation(),W(),L("TIMEOUT","Joe got lost! Too many moves without finding the exit.");break}const e=O();A("THINKING");try{const t=await H(m);f.push({vision:e,action:t,position:{...a},direction:c}),f.length>5&&f.shift(),i.length>50&&(i=i.slice(-30)),T.length>30&&(T=T.slice(-20)),A("READY");const n=N(t);if(h=Date.now(),n){stopNavigation();break}await new Promise(t=>setTimeout(t,300))}catch(t){A("ERROR"),await new Promise(t=>setTimeout(t,1e3))}}})().catch(t=>{stopNavigation(),L("ERROR","Navigation failed: "+t.message)})):L("MODEL NOT LOADED","The model failed to load.\n\nThis might be due to:\n\u2022 Slow internet connection\n\u2022 Browser compatibility issues\n\u2022 Model server being temporarily unavailable\n\nPlease refresh the page to try again."):L("ERROR","Please enter a navigation prompt first!")},window.stopNavigation=function(){e=!1,o=!1,l&&(clearInterval(l),l=null),document.getElementById("start-button").disabled=!1,document.getElementById("pause-button").disabled=!0,document.getElementById("step-button").disabled=!1,$("Navigation stopped.")},window.pauseNavigation=function(){if(!e)return;o=!o;const t=document.getElementById("pause-button");o?(p=Date.now(),g&&(clearInterval(g),g=null),t.textContent="RESUME",t.classList.add("success"),t.classList.remove("warning"),$("Navigation paused."),A()):(p&&(w+=Date.now()-p,p=null),v&&(g=setInterval(()=>{C()},1e3)),t.textContent="PAUSE",t.classList.remove("success"),t.classList.add("warning"),$("Navigation resumed."))},window.stepOnce=async function(){const t=document.getElementById("prompt-input"),e=t.value.trim();if(!e)return void L("ERROR","Please enter a navigation prompt first!");if(!n)return void L("MODEL NOT LOADED","The model failed to load.\n\nThis might be due to:\n\u2022 Slow internet connection\n\u2022 Browser compatibility issues\n\u2022 Model server being temporarily unavailable\n\nPlease refresh the page to try again.");v||M(),R||(R=!0,t.disabled=!0,t.style.cursor="not-allowed",t.style.backgroundColor="#f0f0f0");const o=document.getElementById("step-button"),i=document.getElementById("start-button");if(o.disabled=!0,i.disabled=!0,0!==s&&m||(document.getElementById("move-history").innerHTML="",$("Step mode - executing one move")),m=e,s>200)return L("TIMEOUT","Joe got lost! Too many moves without finding the exit."),void(o.disabled=!1);try{const t=O();A("THINKING");const n=await H(e);f.push({vision:t,action:n,position:{...a},direction:c}),f.length>5&&f.shift(),A(),N(n)?I():(o.disabled=!1,i.disabled=!1)}catch(t){L("ERROR","Step failed: "+t.message),o.disabled=!1,i.disabled=!1,A()}},window.resetMaze=function(){stopNavigation(),W(),v=null,w=0,p=null,document.getElementById("timer").textContent="0:00",s=0,c="SOUTH",i=[],f=[],r=[],T=[],R=!1;const t=document.getElementById("prompt-input");t&&(t.disabled=!1,t.style.cursor="text",t.style.backgroundColor="#ffffff"),E(),y(),A(),S(),document.getElementById("move-history").innerHTML='<div class="move-item">Maze reset. Ready to navigate!</div>'},window.closeMessage=function(){document.getElementById("message-box").classList.remove("active")},window.copyHistory=function(){const t=document.getElementById("move-history").querySelectorAll(".move-item");let n="AGENT JOE - Navigation History\n";n+="================================\n\n",n+=`Prompt: ${m||"No prompt set"}\n`,n+=`Total Moves: ${s}\n\n`,t.forEach(t=>{n+=t.textContent+"\n"}),navigator.clipboard.writeText(n).then(()=>{const t=document.querySelector(".panel-title button").textContent,n=document.querySelector(".panel-title button");n.textContent="COPIED!",setTimeout(()=>{n.textContent=t},1500)}).catch(t=>{L("ERROR","Failed to copy history to clipboard.")})},window.reloadModel=async function(t){e&&pauseNavigation(),n&&(n=null);const o=document.getElementById("loading");o.classList.add("active");try{const e=modelConfigs[t].name,o={initProgressCallback:t=>{const n=document.querySelector(".loading-text");n&&t.text&&(n.textContent=t.text)}};n=await CreateMLCEngine(e,o),L("MODEL LOADED","Successfully switched to "+e)}catch(t){L("ERROR","Failed to load model: "+t.message)}finally{o.classList.remove("active")}},window.openDebugView=function(){document.getElementById("debug-modal").classList.add("active"),F()},window.closeDebugView=function(){document.getElementById("debug-modal").classList.remove("active")},window.clearDebugLog=function(){T=[],F()},window.copyDebugLog=function(){const t=T.map(t=>`=== Move ${t.moveNumber} - ${t.timestamp} ===\nModel: ${t.request.model}\nVision: Front=${t.vision.front}, Left=${t.vision.left}, Right=${t.vision.right}, Behind=${t.vision.behind}\n\nREQUEST:\n${JSON.stringify(t.request.messages,null,2)}\n\nTemperature: ${t.request.temperature}\nMax Tokens: ${t.request.maxTokens}\n\nRESPONSE:\n${t.response.raw}\n\nPARSED ACTION: ${t.response.action}\n========================================\n`).join("\n");navigator.clipboard.writeText(t).then(()=>{const t=event.target,n=t.textContent;t.textContent="COPIED!",setTimeout(()=>{t.textContent=n},1500)}).catch(t=>{})},window.showTemplateHelp=function(){const t=document.getElementById("template-help-modal");t&&t.classList.add("active")},window.closeTemplateHelp=function(){const t=document.getElementById("template-help-modal");t&&t.classList.remove("active")},window.showHowToPlay=function(){const t=document.getElementById("how-to-play-modal");t&&t.classList.add("active")},window.closeHowToPlay=function(){const t=document.getElementById("how-to-play-modal");t&&t.classList.remove("active")},window.showMazeHelp=function(){const t=document.getElementById("maze-help-modal");t&&t.classList.add("active")},window.closeMazeHelp=function(){const t=document.getElementById("maze-help-modal");t&&t.classList.remove("active")},window.showStatusHelp=function(){const t=document.getElementById("status-help-modal");t&&t.classList.add("active")},window.closeStatusHelp=function(){const t=document.getElementById("status-help-modal");t&&t.classList.remove("active")},window.showVisionHelp=function(){const t=document.getElementById("vision-help-modal");t&&t.classList.add("active")},window.closeVisionHelp=function(){const t=document.getElementById("vision-help-modal");t&&t.classList.remove("active")},window.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("prompt-input");t&&(t.addEventListener("click",function(t){R&&L("PROMPT LOCKED","The prompt cannot be modified after starting or stepping through the game.\n\nYou must RESET the game to change your prompt.\n\nThis ensures consistent navigation behavior throughout the game.")}),t.addEventListener("focus",function(t){R&&(this.blur(),L("PROMPT LOCKED","The prompt cannot be modified after starting or stepping through the game.\n\nYou must RESET the game to change your prompt.\n\nThis ensures consistent navigation behavior throughout the game."))}))}),window.addEventListener("DOMContentLoaded",async function(){if("complete"===document.readyState||"interactive"===document.readyState){try{E(),y(),A(),S(),setTimeout(()=>{L("WELCOME AGENT","Your mission: Write a prompt that will guide Agent Joe through the maze!\n\nJoe can see walls and empty spaces in front, behind, left, and right.\n\nYour prompt will control his decision-making at each step.\n\nCan you write the perfect navigation algorithm?")},100)}catch(t){return void setTimeout(()=>{L("ERROR","Failed to initialize game. Please refresh.")},100)}setTimeout(async()=>{try{await async function(){const t=document.getElementById("loading");t.classList.add("active");try{const t=modelConfigs[window.currentModel].name,e={initProgressCallback:t=>{const n=document.querySelector(".loading-text");t.text&&(n.textContent="LOADING MODEL: "+t.text.toUpperCase())}};n=await CreateMLCEngine(t,e)}catch(t){L("ERROR",`Failed to load model: ${t.message||"Unknown error"}. Please check your internet connection and refresh the page.`)}finally{t.classList.remove("active")}}()}catch(t){}},200)}})}();
})();</script>